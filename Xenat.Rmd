---
title: "Xenat"
output: html_document
date: "2023-09-01"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
library(rstatix)
library(GGally)
library(patchwork)
```
Завантажуємо дані.  
Вони містять опис гістологічного типу пухлити, ER, PR, HER2 статуси, T, N, рівень експресії генів.  

```{r}
Data <- read_tsv('Xena.tsv')
Data[, 2:14] |> drop_na(BIN1) -> Data
```
Розділяємо дані на навколопухлинні тканини (норму) та власне пухлини.  
Знову видаляємо групи з малою кількістю спостережень.  
```{r}
Data |> filter(sample_type=='Solid Tissue Normal') -> Normal
Data |> filter(sample_type=='Primary Tumor') -> Tumor

Normal |> group_by(histological_type) |> summarise(count = length(BIN1))
```

```{r}
Tumor |> group_by(histological_type) |>  summarize(count = length(BIN1))
```

```{r}
ggpairs(Normal[, 9:13])
```

Порівнюємо експресію в різних гістологічних типах НПТ.
```{r}
kruskal.test(BIN1 ~ histological_type, Normal)
kruskal.test(AMPH ~ histological_type, Normal)
kruskal.test(WASL ~ histological_type, Normal)
kruskal.test(WIPF1 ~ histological_type, Normal)
kruskal.test(WIPF3 ~ histological_type, Normal)
```

Порівнюємо експресію TKS5 в різних гістологічних типах пухлин.
```{r}
kruskal.test(BIN1 ~ histological_type, Tumor)   #dif
kruskal.test(AMPH ~ histological_type, Tumor)   #dif
kruskal.test(WASL ~ histological_type, Tumor)   #dif
kruskal.test(WIPF1 ~ histological_type, Tumor)  #dif
kruskal.test(WIPF3 ~ histological_type, Tumor)  #dif
```

```{r}
Tumor |> wilcox_test(BIN1 ~ histological_type) |> print.data.frame()
Tumor |> wilcox_test(AMPH ~ histological_type) |> print.data.frame()
Tumor |> wilcox_test(WASL ~ histological_type) |> print.data.frame()
Tumor |> wilcox_test(WIPF1 ~ histological_type) |> print.data.frame()
Tumor |> wilcox_test(WIPF3 ~ histological_type) |> print.data.frame()
```

```{r}
gg <- ggplot(Tumor)+aes(histological_type)+geom_boxplot(aes(y = BIN1))
gg
```

Перегруповуємо дані для оцінки експресії в "Infiltrating Lobular Carcinoma" порівняно з **відповідною** НПТ.
```{r}
data <- rbind(Tumor, Normal)

data |> filter(histological_type=='Infiltrating Lobular Carcinoma') -> ILC
sub1 <- subset(ILC, sample_type == 'Primary Tumor')
sub2 <- subset(ILC, sample_type == 'Solid Tissue Normal')
wilcox.test(sub1$BIN1, sub2$BIN1)    #dif
wilcox.test(sub1$WIPF3, sub2$WIPF3)  #dif
```

в групі 'Infiltrating Ductal Carcinoma' порівно з **відповідною** НПТ.
```{r}
data |> filter(histological_type=='Infiltrating Ductal Carcinoma') -> IDC
sub1 <- subset(IDC, sample_type == 'Primary Tumor')
sub2 <- subset(IDC, sample_type == 'Solid Tissue Normal')
wilcox.test(sub1$BIN1, sub2$BIN1)     #dif
```
```{r}
wilcox.test(sub1$WIPF1, sub2$WIPF1)     #dif
wilcox.test(sub1$WIPF3, sub2$WIPF3)     #dif
```

в групі 'Mixed Histology' порівно з **відповідною** НПТ.
```{r}
data |> filter(histological_type=='Mixed Histology (please specify)') -> MH
sub1 <- subset(MH, sample_type == 'Primary Tumor')
sub2 <- subset(MH, sample_type == 'Solid Tissue Normal')
wilcox.test(sub1$BIN1, sub2$BIN1)
wilcox.test(sub1$WASL, sub2$WASL)    #?
```
але порівнно з НПТ не розділених на окремі гістологічні типи.   
Хибно-позитивний результат!
```{r}
wilcox.test(sub1$WIPF3, Normal$WIPF3)     
```

Перегруповуємо дані по рецепторному статусу.
```{r}
data |> filter(ER_Status_nature2012=='Negative', PR_Status_nature2012=='Negative', HER2_Final_Status_nature2012=='Negative') |> select(sample_type, histological_type, BIN1, AMPH, WASL, WIPF1, WIPF3) |> mutate(group = 'Triple') -> Triple
```

```{r}
data |> filter(ER_Status_nature2012=='Negative', PR_Status_nature2012=='Negative', HER2_Final_Status_nature2012=='Positive') |> select(sample_type, histological_type, BIN1, AMPH, WASL, WIPF1, WIPF3) |> mutate(group = 'Enriched') -> Enriched
```

```{r}
data |> filter(sample_type=='Solid Tissue Normal') |> select(sample_type, histological_type, BIN1, AMPH, WASL, WIPF1, WIPF3) |> mutate(group = 'Norm') -> Norm
```

```{r}
data |> filter(ER_Status_nature2012=='Positive', PR_Status_nature2012=='Positive', HER2_Final_Status_nature2012=='Negative') |> select(sample_type, histological_type, BIN1, AMPH, WASL, WIPF1, WIPF3) |> mutate(group = 'A') -> A
```

```{r}
data |> filter(ER_Status_nature2012=='Positive',  PR_Status_nature2012=='Negative', HER2_Final_Status_nature2012=='Negative') |> select(sample_type, histological_type, BIN1, AMPH, WASL, WIPF1, WIPF3) |> mutate(group = 'B-') -> Bm
```

```{r}
data |> filter(ER_Status_nature2012=='Positive', HER2_Final_Status_nature2012=='Positive') |> select(sample_type, histological_type, BIN1, AMPH, WASL, WIPF1, WIPF3) |> mutate(group = 'B+') -> Bp
```

```{r}
dt <- rbind(A, Bm, Bp, Enriched, Norm, Triple) 

#write_csv(dt, 'Tidy_Xenat.csv')
#dt <- read_csv('Tidy_Xenat.csv')

dt |>  group_by(group) |> summarise(count = length(AMPH))
```
Розділяємо на відповідні гістологічні групи.
```{r}
dt |> filter(histological_type=='Infiltrating Ductal Carcinoma') -> IDC
dt |> filter(histological_type=='Infiltrating Lobular Carcinoma') -> ILC
dt |> filter(histological_type=='Mixed Histology (please specify)') -> MH
dt |> filter(histological_type=='Other, specify') -> OT
```

Перевірка нормальності.
```{r}
sub <- subset(IDC, group == 'A')
shapiro.test(sub$BIN1)
```
Оцінка експресії в групах за рецепторним статусом в межах 'Infiltrating Ductal Carcinoma' гістологічного типу.

```{r}
kruskal.test(BIN1 ~ group, IDC)
kruskal.test(AMPH ~ group, IDC)
kruskal.test(WASL ~ group, IDC)
kruskal.test(WIPF1 ~ group, IDC)
kruskal.test(WIPF3 ~ group, IDC)
```


```{r}
IDC |> wilcox_test(BIN1 ~ group) |> print.data.frame()
IDC |> wilcox_test(AMPH ~ group) |> print.data.frame()
IDC |> wilcox_test(WASL ~ group) |> print.data.frame()
IDC |> wilcox_test(WIPF1~ group) |> print.data.frame()
IDC |> wilcox_test(WIPF3 ~ group) |> print.data.frame()
```

```{r}
b <- ggplot(IDC)+aes(group)+
  geom_boxplot(aes(y = BIN1))
a <- ggplot(IDC)+aes(group)+
  geom_boxplot(aes(y = AMPH))
w <- ggplot(IDC)+aes(group)+
  geom_boxplot(aes(y = WASL))
w1  <- ggplot(IDC)+aes(group)+
  geom_boxplot(aes(y = WIPF1))
w3 <- ggplot(IDC)+aes(group)+
  geom_boxplot(aes(y = WIPF3))

b+a+w+w1+w3
```
  
в групах за рецепторним статусом в межах 'Infiltrating Lobular Carcinoma' гістологічного типу.
```{r}
kruskal.test(BIN1 ~ group, ILC)   #dif
kruskal.test(AMPH ~ group, ILC)
kruskal.test(WASL ~ group, ILC)
kruskal.test(WIPF1 ~ group, ILC)
kruskal.test(WIPF3 ~ group, ILC)
```

```{r}
ILC |> wilcox_test(BIN1 ~ group) |> print.data.frame()
```

```{r}
b <- ggplot(ILC)+aes(group)+
  geom_boxplot(aes(y = BIN1))
b
```
в групах за рецепторним статусом в межах 'Mixed Histology' гістологічного типу.

```{r}
kruskal.test(BIN1 ~ group, MH)   #dif
kruskal.test(AMPH ~ group, MH)
kruskal.test(WASL ~ group, MH)   #dif
kruskal.test(WIPF1 ~ group, MH)
kruskal.test(WIPF3 ~ group, MH)
```

```{r}
MH |> wilcox_test(BIN1 ~ group) |> print.data.frame()
MH |> wilcox_test(WASL ~ group) |> print.data.frame()
```

```{r}
b <- ggplot(MH)+aes(group)+
  geom_boxplot(aes(y = BIN1))
w <- ggplot(MH)+aes(group)+
  geom_boxplot(aes(y = WASL))
b+w
```

```{r}
kruskal.test(BIN1 ~ group, OT)   #dif
kruskal.test(AMPH ~ group, OT)
kruskal.test(WASL ~ group, OT)   
kruskal.test(WIPF1 ~ group, OT)
kruskal.test(WIPF3 ~ group, OT)  #dif
```
  
Без розподілу за гістологічним типом нема хибно-позитивного результату, але це зменшує дисперсію.
Зменшення вибірки впливає на CR16 та N-WASP.
```{r}
kruskal.test(BIN1 ~ group, dt)
kruskal.test(AMPH ~ group, dt)
kruskal.test(WASL ~ group, dt)
kruskal.test(WIPF1 ~ group, dt)
kruskal.test(WIPF3 ~ group, dt)

kruskal.test(WIPF1 ~ group, sample_n(dt, 100))
```

```{r}
dt |> wilcox_test(BIN1 ~ group) |> print.data.frame()
dt |> wilcox_test(AMPH ~ group) |> print.data.frame()
dt |> wilcox_test(WASL ~ group) |> print.data.frame()
dt |> wilcox_test(WIPF1~ group) |> print.data.frame()
dt |> wilcox_test(WIPF3 ~ group) |> print.data.frame()
```

```{r}
b <- ggplot(dt)+aes(group)+
  geom_boxplot(aes(y = BIN1))
a <- ggplot(dt)+aes(group)+
  geom_boxplot(aes(y = AMPH))
w <- ggplot(dt)+aes(group)+
  geom_boxplot(aes(y = WASL))
w1  <- ggplot(dt)+aes(group)+
  geom_boxplot(aes(y = WIPF1))
w3 <- ggplot(dt)+aes(group)+
  geom_boxplot(aes(y = WIPF3))

b+a+w+w1+w3
```

```{r}
kruskal.test(WASL ~ histological_type, A)
```

ANOVA model
```{r}
summary(aov(BIN1 ~ group*histological_type, dt))
```

```{r}
summary(aov(AMPH ~ group*histological_type, dt))
```

```{r}
summary(aov(WASL ~ group*histological_type, dt))
```

```{r}
summary(aov(WIPF1 ~ group*histological_type, dt))
```

```{r}
summary(aov(WIPF3 ~ group*histological_type, dt))
```

```{r}
summary(aov(BIN1 ~ group+histological_type+AMPH+WASL+WIPF1+WIPF3, dt))
```
```{r}
summary(aov(WASL ~ group+histological_type+AMPH+BIN1+WIPF1+WIPF3, dt))
```
```{r}
summary(aov(AMPH ~ group+histological_type+BIN1+WASL+WIPF1+WIPF3, dt))
```

```{r}
summary(aov(WIPF1 ~ group+histological_type+BIN1+AMPH+WASL+WIPF1+WIPF3, dt))
```
```{r}
summary(aov(BIN1 ~ group+histological_type+WASL+WIPF1+WIPF3, dt))
```


